<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="sale_order_portal_content_ouvrage" inherit_id="sale.sale_order_portal_content">
        <!-- 1. Indent Name in Product Line -->
        <xpath expr="//td[@name='td_product_name']" position="inside">
            <t t-if="line.is_ouvrage">
                <strong>(Ouvrage)</strong>
            </t>
            <t t-if="line.ouvrage_parent_line_id">
                <span class="pl-4" style="padding-left: 20px;"> &gt; </span>
            </t>
        </xpath>

        <!-- 2. Hide Price Unit Content (keep cell to preserve alignment) -->
        <xpath expr="//td[@name='td_product_priceunit']/t[@t-if='not collapse_prices']" position="attributes">
             <attribute name="t-if">not collapse_prices and (not line.ouvrage_parent_line_id or not line.ouvrage_parent_line_id.hide_prices)</attribute>
        </xpath>

        <!-- 3. Hide Subtotal Content (keep cell) -->
         <xpath expr="//td[@name='td_product_subtotal']/t[@t-if='not collapse_prices']" position="attributes">
             <attribute name="t-if">not collapse_prices and (not line.ouvrage_parent_line_id or not line.ouvrage_parent_line_id.hide_prices)</attribute>
        </xpath>

        <!-- 4. Hide Line entirely if hide_structure -->
        <xpath expr="//t[@t-foreach='lines_to_report']" position="attributes">
            <attribute name="t-foreach">lines_to_report.filtered(lambda l: not l.ouvrage_parent_line_id or not l.ouvrage_parent_line_id.hide_structure)</attribute>
        </xpath>
    </template>
</odoo>
